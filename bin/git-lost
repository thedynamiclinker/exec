#!/usr/bin/env bash

[[ -z "$1" ]] && {
    echo "usage: $(basename "$0") <regex>"
    exit 1
}

regex="$1"
ref=${2:-HEAD}

git rev-list "$ref" | while read commit; do

    git ls-tree -r "$commit" | grep -P "$regex" | while read line; do

        printf "commit:${commit}\t${line}\n"

    done

done
