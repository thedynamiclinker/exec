#!/usr/bin/env python3

import os
import re
import sys
import argparse

if len(sys.argv) == 1:
    print("usage: command | {0} <trigger>".format(sys.path.basename(sys.argv[0])))
    sys.exit(0)

def parse_command_line():
    parser = argparse.ArgumentParser()

    parser.add_argument(
        'pattern',
        help = 'Pattern to trigger the command to stop printing.'
    )

    parser.add_argument(
        '--inclusive',
        '-i',
        action = 'store_true',
        help = 'Whether to include the matched line.'
    )

    config = parser.parse_args(sys.argv[1:])
    return config

config = parse_command_line()

done = False

while not done:
    line = sys.stdin.readline()
    if not line:
        done = True
    line = line.strip('\n')
    if re.search(config.pattern, line):
        if config.inclusive:
            print(line)
        done = True

while True:
    line = sys.stdin.readline()
    if not line:
        break
    else:
        try:
            sys.stdout.write(line)
        except BrokenPipeError:
            break


