#!/usr/bin/env python

import os
import sys

from ultralytics import YOLO

cache_dir = os.path.expanduser("~/.cache/yolo")
os.makedirs(cache_dir, exist_ok=True)
model = YOLO(f"{cache_dir}/yolo26n.pt") # nano = fastest; try yolo26s.pt for more accuracy

def has_person(path):
    r = model(path, conf=0.25, verbose=False)[0]
    has_person = any(r.names[int(c)] == "person" for c in r.boxes.cls)
    return has_person

for line in sys.stdin:
    path = line.rstrip()
    if not os.path.isfile(path):
        continue
    has = has_person(path)
    print(f"{path}\t{has}")
    sys.stdout.flush()
